# å¿«é€Ÿä½¿ç”¨æŒ‡å—

æœ¬æ–‡æ¡£æä¾›ç³»ç»Ÿçš„å¿«é€Ÿä½¿ç”¨æ­¥éª¤å’Œå¸¸è§æ“ä½œã€‚

## ç›®å½•
1. [é¦–æ¬¡å®‰è£…](#é¦–æ¬¡å®‰è£…)
2. [æ•°æ®é›†å‡†å¤‡](#æ•°æ®é›†å‡†å¤‡)
3. [æ¨¡å‹è®­ç»ƒ](#æ¨¡å‹è®­ç»ƒ)
4. [å¯åŠ¨åº”ç”¨](#å¯åŠ¨åº”ç”¨)
5. [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## é¦–æ¬¡å®‰è£…

### æ­¥éª¤1: å…‹éš†ä»“åº“
```bash
git clone https://github.com/soujyuhs16/memontree26.git
cd memontree26
```

### æ­¥éª¤2: åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# æˆ–
venv\Scripts\activate  # Windows
```

### æ­¥éª¤3: å®‰è£…ä¾èµ–
```bash
pip install -r requirements.txt
```

### æ­¥éª¤4: éªŒè¯å®‰è£…
```bash
python verify_system.py
```

å¦‚æœæ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼Œè¯´æ˜ç¯å¢ƒé…ç½®æˆåŠŸï¼

## æ•°æ®é›†å‡†å¤‡

### ç¡®è®¤æ•°æ®é›†æ–‡ä»¶
ç¡®ä¿ä»¥ä¸‹6ä¸ªCSVæ–‡ä»¶å­˜åœ¨äºDatasetç›®å½•ï¼š
- Dataset/AbuseSet/AbuseSet.csv
- Dataset/SexHarmset/SexHarmSet.csv
- Dataset/BiasSet/Bias_region.csv
- Dataset/BiasSet/BiasSet_genden.csv
- Dataset/BiasSet/Bias_race.csv
- Dataset/BiasSet/Bias_occupation.csv

### ç”Ÿæˆå¤šæ ‡ç­¾æ•°æ®é›†
```bash
python build_multilabel_dataset.py
```

**é¢„æœŸè¾“å‡ºï¼š**
```
============================================================
æ•°æ®é›†ç»Ÿè®¡ä¿¡æ¯
============================================================
è¾“å‡ºæ–‡ä»¶: data/all_multilabel.csv
æ€»è¡Œæ•°: 53509

å„æ ‡ç­¾æ­£æ ·æœ¬æ•°:
  porn: 4999 (9.34%)
  abuse: 5493 (10.27%)
  region: 4398 (8.22%)
  gender: 2800 (5.23%)
  race: 5005 (9.35%)
  occupation: 4100 (7.66%)
```

ç”Ÿæˆçš„æ–‡ä»¶ï¼š`data/all_multilabel.csv`

## æ¨¡å‹è®­ç»ƒ

### å¼€å§‹è®­ç»ƒ
```bash
python train_multilabel.py
```

**è®­ç»ƒæ—¶é—´ï¼š**
- GPU (V100): çº¦30-60åˆ†é’Ÿ
- CPU: çº¦2-4å°æ—¶

**æ³¨æ„äº‹é¡¹ï¼š**
1. é¦–æ¬¡è¿è¡Œä¼šä»Hugging Faceä¸‹è½½é¢„è®­ç»ƒæ¨¡å‹ï¼ˆçº¦400MBï¼‰
2. éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥
3. è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨ä¿å­˜æœ€ä½³æ¨¡å‹

**è®­ç»ƒå®Œæˆæ ‡å¿—ï¼š**
- åœ¨ `outputs/best_model/` ç›®å½•ä¸‹ç”Ÿæˆæ¨¡å‹æ–‡ä»¶
- ç”Ÿæˆè®­ç»ƒæŠ¥å‘Š `outputs/training_report.txt`

### æŸ¥çœ‹è®­ç»ƒç»“æœ
```bash
cat outputs/training_report.txt
```

## å¯åŠ¨åº”ç”¨

### å¯åŠ¨Streamlit
```bash
streamlit run app.py
```

**é»˜è®¤åœ°å€ï¼š** http://localhost:8501

### åº”ç”¨åŠŸèƒ½

#### 1. å•æ¡æ–‡æœ¬å®¡æ ¸
- åœ¨å·¦ä¾§è¾¹æ è°ƒæ•´é˜ˆå€¼
- è¾“å…¥å¾…å®¡æ ¸æ–‡æœ¬
- ç‚¹å‡»"å¼€å§‹å®¡æ ¸"
- æŸ¥çœ‹ç»“æœï¼ˆåŒ…æ‹¬è§„åˆ™åŒ¹é…ã€æ¦‚ç‡ã€åˆ¤å®šï¼‰

#### 2. æ‰¹é‡æ–‡æœ¬å®¡æ ¸
- å‡†å¤‡CSVæ–‡ä»¶ï¼ˆå¿…é¡»åŒ…å« `text` åˆ—ï¼‰
- å¯ä»¥ä½¿ç”¨ `example_batch.csv` ä½œä¸ºæ¨¡æ¿
- ä¸Šä¼ æ–‡ä»¶å¹¶ç‚¹å‡»"å¼€å§‹æ‰¹é‡å®¡æ ¸"
- ä¸‹è½½ç»“æœCSV

#### 3. æŸ¥çœ‹å®¡è®¡æ—¥å¿—
æ‰€æœ‰å•æ¡é¢„æµ‹è‡ªåŠ¨è®°å½•åˆ°ï¼š
```bash
cat logs/pred_log.csv
```

## å¸¸è§é—®é¢˜

### Q1: pip install å¤±è´¥
**A:** å°è¯•ä½¿ç”¨å›½å†…é•œåƒæºï¼š
```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q2: æ¨¡å‹ä¸‹è½½å¤±è´¥
**A:** æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œæˆ–é…ç½®Hugging Faceé•œåƒï¼š
```bash
export HF_ENDPOINT=https://hf-mirror.com
python train_multilabel.py
```

### Q3: è®­ç»ƒæ—¶å†…å­˜ä¸è¶³
**A:** ä¿®æ”¹ `train_multilabel.py` ä¸­çš„ `batch_size`ï¼š
```python
batch_size = 8  # ä»16æ”¹ä¸º8
```

### Q4: æƒ³ä½¿ç”¨ä¸åŒçš„é¢„è®­ç»ƒæ¨¡å‹
**A:** ä¿®æ”¹ `train_multilabel.py` ä¸­çš„ `model_name`ï¼š
```python
model_name = 'bert-base-chinese'  # æˆ–å…¶ä»–ä¸­æ–‡æ¨¡å‹
```

### Q5: Streamlitæ— æ³•è®¿é—®
**A:** æŒ‡å®šç«¯å£å¯åŠ¨ï¼š
```bash
streamlit run app.py --server.port 8502
```

### Q6: å¦‚ä½•è°ƒæ•´åˆ¤å®šé˜ˆå€¼ï¼Ÿ
**A:** åœ¨Streamlitåº”ç”¨çš„å·¦ä¾§è¾¹æ ä¸­ï¼š
1. ä½¿ç”¨"å…¨å±€é˜ˆå€¼"å¿«é€Ÿè°ƒæ•´æ‰€æœ‰æ ‡ç­¾
2. æˆ–å•ç‹¬è°ƒæ•´æ¯ä¸ªæ ‡ç­¾çš„é˜ˆå€¼
3. å®æ—¶æŸ¥çœ‹åˆ¤å®šç»“æœå˜åŒ–

### Q7: æ‰¹é‡é¢„æµ‹å¾ˆæ…¢æ€ä¹ˆåŠï¼Ÿ
**A:** 
1. ç¡®ä¿ä½¿ç”¨GPUç‰ˆæœ¬çš„PyTorch
2. å¯ä»¥å¢åŠ æ¨¡å‹çš„batchå¤„ç†ï¼ˆéœ€ä¿®æ”¹app.pyï¼‰
3. å¯¹äºå¤§é‡æ•°æ®ï¼Œå»ºè®®ä½¿ç”¨å‘½ä»¤è¡Œæ‰¹å¤„ç†è€ŒéStreamlit

### Q8: å¦‚ä½•é‡æ–°è®­ç»ƒæ¨¡å‹ï¼Ÿ
**A:** åˆ é™¤æ—§æ¨¡å‹å¹¶é‡æ–°è®­ç»ƒï¼š
```bash
rm -rf outputs/
python train_multilabel.py
```

### Q9: æ•°æ®é›†å¯ä»¥è‡ªå®šä¹‰å—ï¼Ÿ
**A:** å¯ä»¥ï¼ä¿®æ”¹ `build_multilabel_dataset.py` ä¸­çš„æ–‡ä»¶è·¯å¾„å’Œæ ‡ç­¾æ˜ å°„ã€‚

### Q10: å¦‚ä½•éƒ¨ç½²åˆ°æœåŠ¡å™¨ï¼Ÿ
**A:** 
1. ç¡®ä¿æœåŠ¡å™¨å®‰è£…äº†æ‰€æœ‰ä¾èµ–
2. ä½¿ç”¨ nohup æˆ– screen åå°è¿è¡Œï¼š
```bash
nohup streamlit run app.py --server.port 8501 &
```
3. é…ç½®é˜²ç«å¢™å¼€æ”¾ç«¯å£
4. ç”Ÿäº§ç¯å¢ƒå»ºè®®ä½¿ç”¨Dockeræˆ–K8séƒ¨ç½²

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. ä½¿ç”¨GPUåŠ é€Ÿ
ç¡®ä¿å®‰è£…GPUç‰ˆæœ¬çš„PyTorchï¼š
```bash
pip install torch --index-url https://download.pytorch.org/whl/cu118
```

### 2. å¢åŠ è®­ç»ƒè½®æ•°
ä¿®æ”¹ `train_multilabel.py`ï¼š
```python
num_epochs = 5  # ä»3æ”¹ä¸º5
```

### 3. è°ƒæ•´å­¦ä¹ ç‡
å°è¯•ä¸åŒçš„å­¦ä¹ ç‡ï¼š
```python
learning_rate = 3e-5  # ä»2e-5æ”¹ä¸º3e-5
```

### 4. ä½¿ç”¨æ›´å¤§çš„æ¨¡å‹
```python
model_name = 'hfl/chinese-roberta-wwm-ext-large'
```

### 5. æ•°æ®å¢å¼º
å¯ä»¥æ·»åŠ æ•°æ®å¢å¼ºé€»è¾‘åˆ° `build_multilabel_dataset.py`

## æŠ€æœ¯æ”¯æŒ

é‡åˆ°é—®é¢˜ï¼Ÿ
1. æŸ¥çœ‹æœ¬æ–‡æ¡£çš„å¸¸è§é—®é¢˜éƒ¨åˆ†
2. è¿è¡Œ `python verify_system.py` æ£€æŸ¥ç³»ç»Ÿé…ç½®
3. æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯
4. åœ¨GitHubä»“åº“æäº¤Issue

## ç‰ˆæœ¬å†å²

### v1.0.0 (2024-02-16)
- âœ… åˆå§‹ç‰ˆæœ¬å‘å¸ƒ
- âœ… æ•°æ®é›†æ„å»ºåŠŸèƒ½
- âœ… å¤šæ ‡ç­¾è®­ç»ƒåŠŸèƒ½
- âœ… Streamlitæ¼”ç¤ºç•Œé¢
- âœ… è§„åˆ™èåˆæ£€æµ‹
- âœ… æ‰¹é‡é¢„æµ‹åŠŸèƒ½
- âœ… å®¡è®¡æ—¥å¿—åŠŸèƒ½

---

**ç¥ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰
